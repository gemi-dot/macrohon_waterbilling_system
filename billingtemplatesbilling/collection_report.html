{% extends 'billing/base.html' %}
{% block title %}Collection Report{% endblock %}
{% block page_title %}Collection Report{% endblock %}
{% block content %}
 
<!-- Filter Form -->
<div class='card mb-4'>
  <div class='card-body'>
    <form method='get' class='form-inline'>
      <label class='mr-2'>Month:</label>
      <input type='month' name='month' value='{{ month }}'
             class='form-control form-control-sm mr-3'>
      <button type='submit' class='btn btn-primary btn-sm mr-2'>
        <i class='fa fa-filter'></i> Filter</button>
      <button onclick='window.print()' class='btn btn-secondary btn-sm no-print'>
        <i class='fa fa-print'></i> Print</button>
    </form>
  </div>
</div>
 
<!-- Summary Cards -->
<div class='row mb-4'>
  <div class='col-md-4'>
    <div class='card border-success'>
      <div class='card-body text-center'>
        <h6>Total Collected</h6>
        <h3 class='text-success'>&#8369; {{ summary.total|floatformat:2|default:'0.00' }}</h3>
      </div>
    </div>
  </div>
  <div class='col-md-4'>
    <div class='card border-primary'>
      <div class='card-body text-center'>
        <h6>No. of Payments</h6>
        <h3 class='text-primary'>{{ summary.count|default:0 }}</h3>
      </div>
    </div>
  </div>
</div>
 
<!-- Daily Breakdown -->
<div class='card mb-4'>
  <div class='card-header bg-primary text-white'>Daily Collection Summary</div>
  <div class='table-responsive'>
    <table class='table table-bordered table-hover mb-0'>
      <thead class='thead-dark'>
        <tr><th>Date</th><th>No. of Payments</th><th>Amount</th></tr>
      </thead>
      <tbody>
      {% for d in by_day %}
        <tr>
          <td>{{ d.entry_date|date:'F d, Y' }}</td>
          <td>{{ d.daily_count }}</td>
          <td class='text-right font-weight-bold'>&#8369; {{ d.daily_total|floatformat:2 }}</td>
        </tr>
      {% empty %}
        <tr><td colspan='3' class='text-center text-muted'>No payments this period</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
 
<!-- Individual Payments -->
<div class='card'>
  <div class='card-header bg-dark text-white'>Payment Details</div>
  <div class='table-responsive'>
    <table class='table table-bordered table-sm mb-0'>
      <thead class='thead-dark'>
        <tr><th>Date</th><th>Account</th><th>Subscriber</th><th>OR #</th>
            <th>Received By</th><th class='text-right'>Amount</th></tr>
      </thead>
      <tbody>
      {% for p in payments %}
        <tr>
          <td>{{ p.entry_date|date:'M d, Y' }}</td>
          <td>{{ p.subscriber.account_number }}</td>
          <td>{{ p.subscriber.full_name }}</td>
          <td>{{ p.or_number }}</td>
          <td>{{ p.received_by }}</td>
          <td class='text-right font-weight-bold'>&#8369; {{ p.credit|floatformat:2 }}</td>
        </tr>
      {% endfor %}
      </tbody>
      <tfoot class='table-dark'>
        <tr><td colspan='5' class='font-weight-bold text-right'>GRAND TOTAL:</td>
            <td class='text-right font-weight-bold'>
              &#8369; {{ summary.total|floatformat:2|default:'0.00' }}</td></tr>
      </tfoot>
    </table>
  </div>
</div>
{% endblock %}
